<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <title>zipper: asset packaging for maven</title>

    <script type="text/javascript" src="./javascript/highlight.pack.js"></script>
    <script type="text/javascript">hljs.initHighlightingOnLoad();</script>

    <link rel="stylesheet" href="./style/layout.css" type="text/css" media="screen" /> 
  </head>
  <body>

<pre id="heading">+-++-++-++-++-++-+
|z||i||p||p||e||r|
+-++-++-++-++-++-+</pre>

    <p>
      Zipper is a full-featured asset packaging plugin for 
      <a href="http://maven.apache.org/">Maven</a> that aims at optimiziing
      your project's static resources at build time. 
    </p>
    <p>
      Most of the heavy lifting is done with Google's 
      <a href="http://code.google.com/closure/compiler/">Closure Compiler</a>
      and Yahoo's <a href="http://developer.yahoo.com/yui/compressor/">YUI compressor</a>, 
      but you'll also find CSS and JavaScript concatenation and compression, 
      resource cache busting, and automated lint checking with <a href="http://www.jslint.com/">JSLint</a>.
    </p>

    <p>
      The source code can be found on <a href="https://github.com/joestelmach/zipper">github</a>.
      If you're having trouble, please <a href="https://github.com/joestelmach/zipper/issues">let me know</a>.
    </p>
    <p>
      <a href="#changelog">0.2</a> is the current version.
    </p>

    <h2>Getting Started</h2>
    <ol>
      <li>
        <p>
          Add the following plugin definition to the build section of your POM file:
        </p>

<pre><code>&lt;plugin&gt;
  &lt;groupId&gt;com.joestelmach&lt;/groupId&gt;
  &lt;artifactId&gt;zipper&lt;/artifactId&gt;
  &lt;version&gt;0.2&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;goals&gt;
        &lt;goal&gt;zipper&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
      </li>

      <li>
        <p>
        Create a zipper.properties file in the src/main/resources directory:
        </p>
<pre><code>webroot = src/main/webapp
output.dir = static 
js.asset.script = **/*.js
css.asset.style = **/*.css</code></pre>
    <p>
      This configuration will lint check and optimize all javascript and css files found under src/main/webapp, and then concatenate them to generate script.js and style.css, which will be placed in the target/classes/static directory along with a gzipped version of each.
    </p>
      </li>

      <li>
        <p>
          By default, zipper will automatically be invoked during the <code>package</code> goal, but may be invoked directly:  
        </p>
<pre><code>mvn zipper:zipper</code></pre>
      </li>
    </ol>

    <h2 id="configuration">Configuration</h2>

    <p>
      Zipper uses a properties file for configuration as opposed to the standard block of XML in the POM.  This is justified by the need to access the configuration at runtime to support <a href="#asset_tags">asset tags</a>.
    </p>


    <p>
      The following describes all possible options, none of which are required.
    </p>

    <table>
      <tr class="heading_row">
        <th>option</th>
        <th class='default_heading'>default</th>
        <th>discussion</th>
      </tr>
      <tr>
        <td>webroot</td>
        <td>src/main/webapp</td>
        <td>The path to your project's web root directory.
      </tr>
      <tr>
        <td>output.dir</td>
        <td>static</td>
        <td>The name of the folder placed under target/classes that zipper should populate with optimized assets.
      </tr>
      <tr>
        <td>lint.skip</td>
        <td>false</td>
        <td>Forces all JavaScript lint checks to be skipped.</td>
      </tr>
      <tr>
        <td>lint.exclude</td>
        <td></td>
        <td>Excludes the files matching the given <a href="http://ant.apache.org/manual/dirtasks.html#patterns">pattern</a> from lint checks.</td>
      </tr>
      <tr>
        <td>lint.failonwarning</td>
        <td>false</td>
        <td>When true, the Maven build will fail when a lint warning is encountered.</td>
      </tr>
      <tr>
        <td>lint.option.<em>xxx</em></td>
        <td></td>
        <td>Passes the given value for option <em>xxx</em> to JSLint.  For example: <em>lint.option.newcap=true</em></td>
      </tr>
      <tr>
        <td>js.optimize.level</td>
        <td>WHITESPACE_ONLY</td>
        <td>The Closure Compiler <a href="http://code.google.com/closure/compiler/docs/compilation_levels.html">optimization level</a> to use: WHITESPACE_ONLY, SIMPLE_OPTIMIZATIONS, or ADVANCED_OPTIMIZATIONS</td>
      </tr>
      <tr>
        <td>css.line.break</td>
        <td></td>
        <td>The column at which a line break should be inserted in the minified CSS.
      </tr>
      <tr>
        <td>gzip</td>
        <td>true</td>
        <td>When true, a gzipped version of each grouped asset will be generated</td>
      </tr>
      <tr>
        <td>bust.cache</td>
        <td>true</td>
        <td>When true, each asset's last modified time will be appended to all corresponding URLs, including those found within your CSS files.</td>
      </tr>
      <tr>
        <td>js.asset.<em>xxx</em></td>
        <td></td>
        <td>A <a href="http://ant.apache.org/manual/dirtasks.html#patterns">pattern</a> list defining a JavaScript asset named <em>xxx</em>.  The asset will be a concatentation of the optimized version of all matching files in the order given.</td>
      </tr>
      <tr>
        <td>css.asset.<em>xxx</em></td>
        <td></td>
        <td>A <a href="http://ant.apache.org/manual/dirtasks.html#patterns">pattern</a> list defining a CSS asset named <em>xxx</em>.  The asset will be a concatentation of the minified version of all matching files in the order given.</td>
      </tr>
      <tr>
        <td>environment</td>
        <td>development</td>
        <td>The environment an <a href="#asset_tags">asset tag</a> uses to determine which assets to include.
      </tr>
    </table>


    <h2 id="asset_tags">Asset Tags</h2>
    <p>
      Concatenating and optimizing multiple assets into one file is a great idea for production environments, since we can significantly reduce both the number of HTTP requests and the size of their payload, but this optimization could lead to a significant decrease in productivity if we need to re-optimize our assets each time a change is made.  In order to mitigate this, we need a method for the JSP to selectively include either the original or optimized assets depending on the current environment.  Zipper has solved this problem with a custom JSP tag.
    </p>
    <p>
      To get started, you'll need to add zipper as a dependency in your POM:
    </p>

<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;com.joestelmach&lt;/groupId&gt; 
  &lt;artifactId&gt;zipper&lt;/artifactId&gt;
  &lt;version&gt;0.2&lt;/version&gt;
&lt;/dependency&gt;</code></pre>

    <p>
      Then you can use the <code>&lt;zipper:asset&gt;</code> tag in your JSP pages:
    </p>

<pre><code>&lt;%@ taglib prefix="zipper" uri="http://joestelmach.com/zipper" %&gt;

&lt;zipper:asset type="css" name="style"/&gt;
&lt;zipper:asset type="js" name="script"/&gt;</code></pre>

    <p>
      This tag will either include the optimized asset with the given name, or each file the optimized asset consists of, depending on the environment.  The last piece of the puzzle is letting zipper know which environment we're running in.  This can be done either by setting a System property named <em>environment</em>, or by specifiying the <em>environment</em> option in the zipper.properties file.
    </p>

    <p>
      When the environment value is <em>development</em>, the original files will be included.  All other values will cause the optimized assets to be included.  If you change this value at runtime, The JSP page will need to be re-compiled.
    </p>

    <h2 id="changelog">Changelog</h2>
    <dl>
      <dt>version 0.2</dt>
      <dd>Integrated the closure-compiler artifact (Thanks @lindner)</dd>
      <dd>Improved the css cache-busting regex</dd>

      <dt>version 0.1</dt>
      <dd>initial release</dd>
    </dl>
  </body>
</html>

